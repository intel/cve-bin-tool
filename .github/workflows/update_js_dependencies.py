import json
import shutil
import urllib.request
import zipfile
from os import path, remove

# bootstrap
_json = json.loads(
    urllib.request.urlopen(
        urllib.request.Request(
            "https://api.github.com/repos/twbs/bootstrap/releases/latest",
            headers={"Accept": "application/vnd.github.v3+json"},
        )
    ).read()
)
asset = next(x for x in _json["assets"] if "dist" in x["name"])
asset_name: str = asset["name"]
urllib.request.urlretrieve(asset["browser_download_url"], asset_name)

with zipfile.ZipFile(asset_name, "r") as zip_ref:
    zip_ref.extractall()

tmp_dir = asset_name.replace(".zip", "")
shutil.copy(
    path.join(tmp_dir, "js", "bootstrap.min.js"),
    path.join("cve_bin_tool", "output_engine", "html_reports", "js", "bootstrap.js"),
)

shutil.rmtree(tmp_dir)
remove(asset_name)

# plotly.js
_json = json.loads(
    urllib.request.urlopen(
        urllib.request.Request(
            "https://api.github.com/repos/plotly/plotly.js/releases/latest",
            headers={"Accept": "application/vnd.github.v3+json"},
        )
    ).read()
)
urllib.request.urlretrieve(
    f"https://github.com/plotly/plotly.js/raw/{_json['tag_name']}/dist/plotly.min.js",
    path.join("cve_bin_tool", "output_engine", "html_reports", "js", "plotly.js"),
)
