import re
from importlib.metadata import version
from typing import List

new_pins = {"pre-commit": version("pre-commit")}
pre_commit_path = ".pre-commit-config.yaml"
with open(pre_commit_path) as f:
    tools = f.read().split("repo")
    for tool in tools:
        package_match = re.search("id: (.*)", tool)
        if not package_match:
            continue
        version_match = re.search("rev: (.*)", tool)
        if not version_match:
            continue
        new_pins[package_match.group(1)] = version_match.group(1)

lines: List[str] = []
requirements_path = "dev-requirements.txt"
with open(requirements_path) as f:
    lines = f.readlines()
    for ind, line in enumerate(lines):
        package_match = re.search("(.*)==(.*)", line)
        if not package_match:
            continue
        package_name = package_match.group(1)
        if package_name in new_pins:
            lines[ind] = re.sub("==(.*)", f"=={new_pins[package_name]}", line)
with open(requirements_path, "w") as f:
    f.writelines(lines)
