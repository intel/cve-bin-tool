#!python

import pytest
import pkg_resources
from cve_bin_tool.checkers import *


class TestCheckers:
    """Run a series of tests directly against individual checkers.
    This is a companion to the tests in TestScanner."""

    @pytest.mark.parametrize(
        "checker_name, file_name, expected_result",
        [
            ("python", "python3.8", "python"),
            ("python", "python", "python"),
            # ("python", "python3.9", "python"),
            ("bluez", "libbluetooth.so.4", "bluetoothctl"),
        ],
    )
    def test_filename_is(self, checker_name, file_name, expected_result):
        """ Test a checker's filename detection"""
        checkers = pkg_resources.iter_entry_points("cve_bin_tool.checker")
        for checker in checkers:
            if checker.name == checker_name:
                get_version = checker.load()

        result = get_version([""], file_name)
        assert result["is_or_contains"] == "is"
        assert result["modulename"] == expected_result
