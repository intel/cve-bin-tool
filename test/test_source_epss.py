from pathlib import Path

from cve_bin_tool.data_sources import epss_source


class TestSourceEPSS:
    @classmethod
    def setup_class(cls):
        cls.epss = epss_source.Epss_Source()
        cls.epss.file_name = (
            Path(__file__).parent.resolve() / "epss" / "epss_score_test.csv"
        )

    final_data = [
        ("CVE-1999-0001", "EPSS", "0.011", "0.82987"),
        ("CVE-2019-10354", "EPSS", "0.00287", "0.64385"),
        ("CVE-1999-0003", "EPSS", "0.999", "0.88555"),
        ("CVE-2023-28143", "EPSS", "0.00042", "0.05685"),
        ("CVE-2017-15360", "EPSS", "0.00078", "0.31839"),
        ("CVE-2008-4444", "EPSS", "0.07687", "0.93225"),
        ("CVE-1999-0007", "EPSS", "0.00180", "0.54020"),
    ]

    def test_parse_epss(self):
        self.epss_data = self.epss.parse_epss_data(self.epss.file_name)
        assert self.epss_data == self.final_data
