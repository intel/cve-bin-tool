import sys

import atheris
import atheris_libprotobuf_mutator

with atheris.instrument_imports():
    import product_tuple_pb2

    from cve_bin_tool.input_engine import InputEngine


def TestParseData(data):
    try:
        # data should be a fuzzy product tuple
        InputEngine("").parse_data(
            {"vendor", "product", "version"},
            [{"vendor": data.vendor, "product": data.product, "version": data.version}],
        )

    except SystemExit:
        # force return on SystemExit since those are mostly InsufficientArgs
        return


atheris_libprotobuf_mutator.Setup(
    sys.argv, TestParseData, proto=product_tuple_pb2.ProductData
)
atheris.Fuzz()
