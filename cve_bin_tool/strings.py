#!/usr/bin/python3

"""
These are the customized strings and file classes, by doing this
the tool is able to support other operating systems like Windows
and MacOS.
"""
import asyncio
import sys

from .async_utils import FileIO


class Strings:
    # printable characters
    PRINTABLE = set(range(32, 128))
    # add tab to the printable character
    PRINTABLE.add(9)

    def __init__(self, filename=""):
        self.filename = filename
        self.output = [""]

    async def aio_parse(self):
        async with FileIO(self.filename, "rb") as f:
            tmp = []
            async for line in f:
                for char in line:
                    # remove all unprintable characters
                    if char in Strings.PRINTABLE:
                        tmp.append(chr(char))
                    elif tmp:
                        self.output.append("".join(tmp))
                        tmp = []
        return self.output

    def parse(self):
        loop = asyncio.get_event_loop()
        if sys.platform.startswith("win"):
            if isinstance(loop, asyncio.SelectorEventLoop):
                loop = asyncio.ProactorEventLoop()
                asyncio.set_event_loop(loop)
        aws = asyncio.ensure_future(self.aio_parse())
        result = loop.run_until_complete(aws)
        return result
