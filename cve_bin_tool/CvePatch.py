# python 2 compatibility
try:
    from urllib2 import urlopen
except ImportError:
    from urllib.request import urlopen
import re

def find_curl_list():
    """ Extract curl data """
    cve_pattern = re.compile('name=(CVE-[^"]*)')
    nextver_pattern = re.compile('the subsequent release: ([\d.]+)')
    vendor = 'haxx'
    product = 'curl'

    # Start with version 6.0 since that's currently first
    version = "6.0"

    cve_dict = {}
    while (version):
        url = "https://curl.haxx.se/docs/vuln-" + version + ".html"
        response = urlopen(url)
        html = response.read()
        text = html.decode("utf-8")

        cves = re.findall(cve_pattern, text)

        for number in cves:
            if number in cve_dict:
                cve_dict[number] += ', ' + version
            else:
                cve_dict[number] = version
        nextversion = re.findall(nextver_pattern, text)
        if (nextversion):
            version = nextversion[0]
        else:
            version = None

    return cve_dict, vendor, product

def patch_cve_data(cve_number, vendor_name, product_name, exploitability_score, impact_score, severity, versions):
    """
    Adds missing data from specified products
    """
    patches_list = [find_curl_list, ]

    for patch in patches_list:
        data, vendor, product = patch()
        for number, version in data.items():
            cve_number.append(number)
            versions.append(version)
            vendor_name.append(vendor)
            product_name.append(product)
            exploitability_score.append("")
            impact_score.append("")
            severity.append("")