# Copyright (C) 2022 Intel Corporation
# SPDX-License-Identifier: GPL-3.0-or-later

from cve_bin_tool.parsers.java import JavaParser
from cve_bin_tool.parsers.javascript import JavascriptParser
from cve_bin_tool.parsers.python import PythonParser
from cve_bin_tool.parsers.rust import RustParser

valid_files = ["pom.xml", "package-lock.json", "Cargo.lock", "PKG-INFO: ", "METADATA: "]


def parse(filename, output, cve_db, logger):
    # Java checker
    if "pom.xml" in output:
        parser = JavaParser(cve_db, logger)
        yield from parser.run_checker(filename)

    # Javascript checker
    if "package-lock.json" in output:
        parser = JavascriptParser(cve_db, logger)
        yield from parser.run_checker(filename)

    # Rust checker
    if "Cargo.lock" in output:
        parser = RustParser(cve_db, logger)
        yield from parser.run_checker(filename)

    # Python checker
    if "PKG-INFO: " in output or "METADATA: " in output:
        parser = PythonParser(cve_db, logger)
        yield from parser.run_checker(filename)
