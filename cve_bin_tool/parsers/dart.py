# Copyright (C) 2024 Intel Corporation
# SPDX-License-Identifier: GPL-3.0-or-later


from cve_bin_tool.parsers import Parser


class DartParser(Parser):
    """
    A parser class for handling pubspec.lock file

    """

    def __init__(self, cve_db, logger):
        super().__init__(cve_db, logger)

    def run_checker(self, filename):
        """
        Process pubspec.lock file and extract product and version details
        """
        self.filename = filename
        with open(filename) as df:
            lines = df.readlines()
            product = None
            version = None

            for line in lines:
                if "name:" in line:
                    product = line.strip().split(":")[1].strip()
                elif "version:" in line:
                    version = line.strip().split(":")[1].strip().replace('"', "")
                    if product and version:
                        vendor = self.find_vendor(product, version)
                        if vendor:
                            yield from vendor
                        product = None
                        version = None
        self.logger.debug(f"Done scanning file: {self.filename}")
