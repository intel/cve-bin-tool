import csv

from datetime import datetime
from builtins import hash


class OutputEngine:
    def __init__(self, filename=None, modules=None):
        self.filename = filename
        self.modules = modules

        if self.filename == None:
            now = datetime.now()
            self.filename = str(hash(now)).strip("-")

    def output_cves(self, outfile):

        """ Output a list of CVEs
        format is modules[checker_name][version] = dict{id: severity}
        """
        writer = csv.writer(outfile)
        for modulename, versions in self.modules.items():
            for version, cve_list in versions.items():
                for cve_number, cve_severity in cve_list.items():
                    row = [modulename, version, cve_number, cve_severity]
                    writer.writerow(row)

    def output_csv(self):

        """ Generate a CSV file for list of CVE """

        outfile = open(f"Output/{self.filename}.csv", "a")
        writer = csv.writer(outfile)
        writer.writerow(["Module Name", "Version", "CVE Number", "Severity"])
        for modulename, versions in self.modules.items():
            for version, cve_list in versions.items():
                for cve_number, cve_severity in cve_list.items():
                    row = [modulename, version, cve_number, cve_severity]
                    writer.writerow(row)
