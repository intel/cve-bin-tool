""" CVE Checkers """
__all__ = [
    "Checker",
    "bluez",
    "cups",
    "curl",
    "expat",
    "ffmpeg",
    "gnutls",
    "hostapd",
    "icu",
    "kerberos",
    "libdb",
    "libgcrypt",
    "libjpeg",
    "libnss",
    "libtiff",
    "lighttpd",
    "ncurses",
    "nginx",
    "node",
    "nessus",
    "openssh",
    "openssl",
    "openswan",
    "png",
    "postgresql",
    "rsyslog",
    "sqlite",
    "strongswan",
    "syslogng",
    "systemd",
    "varnish",
    "wireshark",
    "xerces",
    "xml2",
    "zlib",
    "python",
    "bzip2",
    "gstreamer",
    "binutils",
]

import re

from cve_bin_tool.util import regex_find


class Checker:
    CONTAINS_PATTERNS = []
    VERSION_PATTERNS = []
    FILENAME_PATTERNS = []
    VENDOR_PACKAGE = []
    MODULE_NAME = ""

    def __init__(self):
        self.VERSION_PATTERNS = map(re.compile, self.VERSION_PATTERNS)
        self.CONTAINS_PATTERNS = map(re.compile, self.CONTAINS_PATTERNS)
        self.FILENAME_PATTERNS = map(re.compile, self.FILENAME_PATTERNS)

    def guess_contains(self, lines):
        for line in lines:
            if any(pattern.search(line) for pattern in self.CONTAINS_PATTERNS):
                return True
        return False

    def get_version(self, lines, filename):
        version_info = dict()
        if any(pattern.search(filename) for pattern in self.FILENAME_PATTERNS):
            version_info["is_or_contains"] = "is"

        if version_info["is_or_contains"] != "is" and self.guess_contains(lines):
            version_info["is_or_contains"] = "contains"

        if "is_or_contains" in version_info:
            version_info["modulename"] = self.MODULE_NAME
            version_info["version"] = regex_find(lines, self.VERSION_PATTERNS)

        return version_info
