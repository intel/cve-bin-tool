#!/usr/bin/env python3
"""
CVE checker for Bluez
References:
https://www.cvedetails.com/vulnerability-list/vendor_id-8316/product_id-35116/Bluez-Bluez.html

"""
from . import Checker
from re import search


class BluezChecker(Checker):
    CONTAINS_PATTERNS = [
        r"Dialog Semiconductor GmbH",
        r"Nordic Semiconductor ASA",
    ]
    FILENAME_PATTERNS = [r"bluetoothctl", r"libbluetooth.so"]
    VERSION_PATTERNS = [
        r"^([5]+\.[0-9]+)$",
    ]
    VENDOR_PRODUCT = [("bluez", "bluez")]

    def get_version(self, lines, filename):

        version_info = super().get_version(lines, filename)
        pattern = r"([5]+\.[0-9]+)"
        next_patterns = [r"Version %s", r"%s ver %s"]
        if "is_or_contains" in version_info.keys():
            if version_info["is_or_contains"] == "is":
                if self.guess_contains(lines):
                    for line in range(len(lines)):
                        match = search(pattern, lines[line])
                        if match:
                            for next_pattern in next_patterns:
                                if search(next_pattern, lines[line + 1]):
                                    version_info["version"] = lines[line]
                                    print("this one", lines[line])
                                    return version_info
        return version_info
